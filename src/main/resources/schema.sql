CREATE TABLE IF NOT EXISTS `USERS` (
  `ID` bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  `EMAIL`  varchar UNIQUE NOT NULL,
  `LOGIN` varchar NOT NULL,
  `NAME` varchar,
  `BIRTHDAY` date NOT NULL
);

CREATE TABLE IF NOT EXISTS `FILM` (
  `ID` bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  `NAME` varchar NOT NULL,
  `DESCRIPTION` varchar,
  `RELEASE_DATE` date NOT NULL,
  `DURATION` integer,
  `MPA_ID` bigint,
  UNIQUE (NAME, DESCRIPTION, RELEASE_DATE, DURATION)
);

CREATE TABLE IF NOT EXISTS `GENRE` (
  `ID` bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  `NAME` varchar UNIQUE
);

CREATE TABLE IF NOT EXISTS `GENRE_FILM` (
  `FILM_ID` bigint,
  `GENRE_ID` bigint,
  PRIMARY KEY (`FILM_ID`, `GENRE_ID`)
);

CREATE TABLE IF NOT EXISTS `MPA` (
  `ID` bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  `NAME` varchar UNIQUE
);

CREATE TABLE IF NOT EXISTS `FRIENDSHIP` (
  `USER_ID` bigint,
  `FRIEND_ID` bigint,
  `STATUS` boolean,
  PRIMARY KEY (`USER_ID`, `FRIEND_ID`)
);

CREATE TABLE IF NOT EXISTS `LIKES` (
  `USER_ID` bigint,
  `FILM_ID` bigint,
  PRIMARY KEY (`USER_ID`, `FILM_ID`)
);

ALTER TABLE `GENRE_FILM` ADD FOREIGN KEY (`FILM_ID`) REFERENCES `FILM` (`ID`);

ALTER TABLE `GENRE_FILM` ADD FOREIGN KEY (`GENRE_ID`) REFERENCES `GENRE` (`ID`);

ALTER TABLE `FILM` ADD FOREIGN KEY (`MPA_ID`) REFERENCES `MPA` (`ID`);

ALTER TABLE `FRIENDSHIP` ADD FOREIGN KEY (`USER_ID`) REFERENCES `USERS` (`ID`);

ALTER TABLE `FRIENDSHIP` ADD FOREIGN KEY (`FRIEND_ID`) REFERENCES `USERS` (`ID`);

ALTER TABLE LIKES ADD FOREIGN KEY (`USER_ID`) REFERENCES `USERS` (`ID`);

ALTER TABLE LIKES ADD FOREIGN KEY (`FILM_ID`) REFERENCES `FILM` (`ID`);